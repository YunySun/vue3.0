<template>
  <div class="book-wrapper">
    <div class="book" :style="{ transform: 'translate3d(' + left + 'px, 0, 0)' }" ref="bookWrapperRef">
      <h3>第十一章光源</h3>
      <p>　　第十一章光源</p>
      <p>　　“我们到底来到了哪里？我想回家……”有些女同学忍不住哭泣出声。</p>
      <p>　　“又是一座五色祭坛……”庞博与叶凡站在一起，两人相互看了一眼，而后又都摇了摇头。他们在大学时便是最好的朋友，毕业后亦时常见面，彼此最是了解，现在两人都感觉情况不妙，众人处境堪忧，此刻充满了未知与变数。</p>
      <p>　　而这个时候，其他人也从空旷的荒漠收回了目光，焦急而又慌乱的打量周围的情况。</p>
      <p>　　巨大的青铜棺椁翻倒在他们的后方，而在铜棺之下则是一个宏大的五色石坛，与在泰山所见的巨型祭坛非常相似，由五种不同颜色的巨石堆砌而成。</p>
      <p>　　五色石坛占地极广，可以想象当年修建时必然是一个浩大的工程，但长年累月的被风沙侵袭，本应高高耸立在地上的巨大祭坛几乎全部淹没在了地下，如今与布满红褐色沙砾的大地齐平。</p>
      <p>　　今日九龙拉棺而至，重重的撞击在地面，才将周围的沙砾震去，令祭坛显露出一个大概的轮廓。不仅巨大的青铜棺椁横陈在祭台上，就是九具庞大的龙尸也都压在上面，可以想象五色石坛的宏大。</p>
      <p>　　“我们……迷失了，找不到回路了。”有位脆弱的女同学哭泣出声，身体摇晃，如果不是有人扶着，早已软倒在地上。</p>
      <p>　　很多人都脸色苍白，在这一刻众人联想到了种种可能，眼前所见到的景象像极了一个陌生的世界。没有人愿意接受这个事实，但是泰山不见了，空旷的荒漠就在眼前，让人不得不沉默。</p>
      <p>　　“不要慌乱，不要恐惧，会有解决的办法。”叶凡大声喊道。</p>
      <p>　　“怎么解决，我们如何回去，怎样……走出这片陌生的世界？”纵然是有些男同学此刻的声音也已颤抖，充满了强烈的惧意与不安。</p>
      <p>　　未知，会让部分人充满敬畏与恐惧，同时也会让另一部分人生出探索的**。</p>
      <p>　　叶凡与庞博避开九具庞大的龙尸，向前走去，想看一看附近的情况。</p>
      <p>　　李小曼就在不远处，似乎有些发冷，抱着双臂，美丽的容颜有些苍白，但却依然显得很平静，如一株清丽的莲花在昏暗中绽放。叶凡路过时脱下上衣递了过去，但她却只是道了一声谢谢，而后摇头拒绝了。</p>
      <p>　　叶凡并没有多说什么，他并不是想挽回什么，披上外衣与庞博继续向前走去。绕过庞大的龙尸与青铜棺椁，他们看到李小曼的美国同学凯德也在观察附近的情况，口中不时出现发出“god”这种惊叹。</p>
      <p>　　在五色石坛不远处有一块巨大的岩石，横卧在那里，光高就足有二十几米，但坡度并不是很陡峭，可以攀爬上去。</p>
      <p>　　叶凡身高一米七九左右，虽然面相看起来很文静，但其实身体很强健，当年是校足球队的主力队员，在球场上经常被人称呼为野蛮人。</p>
      <p>　　而庞博则人如其名，颇有“磅礴”之势，但并不是肥胖，而是真正的强壮，是一个魁梧的大块头，胳膊快抵得上常人的腿那么粗了。</p>
      <p>　　两人的体质都超好，在巨石前快速奔跑起来，根本没有小心攀爬，便直接冲了上去。站在巨石上向远方眺望，竟见到点点微弱的光芒自昏暗中透出，这让两人相当的惊异。</p>
      <p>　　“我们多半回不去了。”对于最好的朋友没有什么不可说，叶凡直接说出自己的推测与判断，道：“这里肯定不是我们所在的那片时空。”</p>
      <p>　　“这里确实已经不是我们所在的那片时空。”庞博虽然平日大大咧咧，但遇到正经事从来不开玩笑，他注视着远方那团微弱的光晕，蹙眉道：“你说这个世界上真的有神吗？”</p>
      <p>　　叶凡也在凝望远处那团若隐若现的光亮，道：“我们连龙尸都看到了，我想纵然一个活生生的神祗出现在我们眼前，我也不会惊讶了。”</p>
      <p>　　“一个活生生的神祗出现在眼前……会是怎样的一个情景。”庞博低语。</p>
      <p>　　身后传来响声，身高足有一米九的凯德也攀登上巨石，当他看到看到远方的那团光亮后，立时发出一声惊呼。</p>
      <p>　　“赞美……仁慈的上帝，我……看到了光明。”他以不太流利的中文说道，而后转身用力向后挥手，冲着人群中的李小曼大声喊道：“我看到了……光明！”随后，他从巨石上攀下，冲向李小曼那里。</p>
      <p>　　凯德的喊叫，顿时令人群一阵纷乱，不少人向这里跑来。</p>
      <p>　　庞博看了看不远处站在一起的李小曼与凯德，对叶凡道：“那洋鬼子到底是不是李小曼的男朋友？”</p>
      <p>　　“我怎么知道。”</p>
      <p>　　“真的就这样放弃了？”庞博斜瞟他。</p>
      <p>
        　　“有些事情即便可以从头再来，也很难再回到原点。纵然是相同的道路，人生可以两次路过，也不再会有原来的感觉。那些都是过去的事情了，人要向前走。”叶凡摇了摇头，而后像是想起了什么，笑道：“还是你这个家伙潇洒，夜生活多姿多彩。”</p>
      <p>　　“我鄙视你，哪里有你的生活丰富。”庞博看了看叶凡，又看了看不远处的李小曼，道：“凭着男人的直觉，我总觉得你们两个人还会发生一些事情。”</p>
      <p>　　“少败坏我名声。”叶凡笑了笑道：“你也跟女人似的有第六感吗？”</p>
      <p>　　此时此刻，恐怕也只有他们两人还能笑的出来，两个人都不是悲观的人，无论什么时候都很难愁眉苦脸。</p>
      <p>　　不多时，不少人攀爬上巨大的岩石，眺望远方，微弱的光亮像是萤火在闪动，穿透昏暗的空间，映入众人的眼帘。那点光源虽然并不明亮，但却像是点燃了众人的希望，不少女同学发出欢呼声。</p>
      <p>　　前方有微弱的光亮，虽然依然充满未知，但是众人都想前进。或许，这是人类的天性，惧怕黑暗，向往光明。</p>
      <p>　　“千万不要让我们失望。”</p>
      <p>　　“希望会有奇迹发生。”</p>
      <p>　　众人陆续攀下巨石，来到五色祭坛前商量对策。</p>
      <p>　　“这里的一切对于我们来说都很陌生，纵然前方有光亮，也要小心一些为好。”王子文比较谨慎小心，提出这样的建议。</p>
      <p>　　周毅一直很镇定，闻言点头道：“不错，先选派几个人探路，反正那团光亮似乎并不是很远，以防万一。”</p>
      <p>　　其他人都表示同意，未知的前路谁也无法预料，陌生的环境一切都要小心为好。</p>
      <p>　　“砰”</p>
      <p>　　突然间，一声剧烈震动传来，五色祭坛上的铜棺发出一声金属颤音。</p>
      <p>　　“发生了什么？”</p>
      <p>　　“我感觉像是铜棺内部发出的声音。”离铜棺最近的一名女同学脸色苍白，这样说道。</p>
      <p>　　闻听此言，众人无不变色，要知道巨棺内部可是有一口装殓尸体的小铜棺啊。</p>
    </div>
  </div>
</template>

<script>
import Tween from "../assets/js/tween.js";

export default {
  name: "book",
  data() {
    return {
      left: 0, // 偏移距离
      loadLeft: 0, // 记录原先的位置
      touchX: 0, // 记录水平点击的位移
      currentX: 0, // 记录水平移动的位移
      distance: 0,
      page: 0,
      total: 0,
      scrollDistance: 0,
      isCorrect: false // 纠正位置状态
    }
  },
  mounted() {
    this.$nextTick(() => {
      this.initBookContainer();
    })
    this.init();

    window.onresize = () => {
      this.initBookContainer();
    }
  },
  methods: {
    // 初始化
    init() {
      this.bindTouchEvents();
    },
    // 获取书籍宽度 页宽度
    initBookContainer() {
      this.left = 0;
      this.scrollDistance = document.body.clientWidth || document.documentElement.clientWidth;
      var contentWidth = this.$refs.bookWrapperRef.scrollWidth
      this.total = Math.ceil(contentWidth / this.scrollDistance) - 1;
    },
    // 绑定手势
    bindTouchEvents() {
      this.$el.addEventListener("touchstart", this.touchStart);
      this.$el.addEventListener("touchmove", this.touchMove);
      this.$el.addEventListener("touchend", this.touchEnd);
    },
    // 开始点击
    touchStart(e) {
      console.log(e)
      if (this.isCorrect) return;
      this.touchX = e.touches[0].clientX;
    },
    // 点击移动
    touchMove(e) {
      if (this.isCorrect) return;
      console.log(e)
      this.currentX = e.touches[0].clientX;
      var diff = this.currentX - this.touchX;
      this.left = this.left + ((diff > 0) ? Math.pow(diff, 0.8) : (-Math.pow(Math.abs(diff), 0.8)));
      this.touchX = this.currentX;
    },
    // 点击完成
    touchEnd() {
      if (this.isCorrect) return;
      this.distance = this.left - this.loadLeft;
      this.loadLeft = this.left;
      console.log(this.left, this.loadLeft)
      if (this.distance > 0) {
        this.page--;
      } else if (this.distance < 0) {
        this.page++;
      } else {
        return;
      }
      this.correctPosition();
    },
    // 纠正到正确的位置
    correctPosition() {
      console.log(this.page, this.total)
      if (this.page <= -1) {
        this.page = 0;
        this.distance = -1;
      } else if (this.total < this.page) {
        this.page = this.total;
        this.distance = 1;
      }
      var correctPosition = -this.page * this.scrollDistance;
      console.log(correctPosition, this.left)
      var offset = (this.distance < 0) ? -15 : 15;
      setTimeout(() => {
        var timer = null;
        var that = this;
        cancelAnimationFrame(timer);
        timer = requestAnimationFrame(function fn() {
          var oLeft = that.left;
          if (((that.left > correctPosition) && (that.distance < 0)) || ((that.left < correctPosition) && (that.distance > 0))) {
            that.isCorrect = true
            that.left = Math.ceil(Tween.Quart.easeInOut(10, oLeft, offset, 10));
            timer = requestAnimationFrame(fn);
          } else {
            cancelAnimationFrame(timer);
            that.isCorrect = false
            that.left = correctPosition;
            that.loadLeft = that.left;
          }
        });
      });
    }
  }
}
</script>

<style scoped lang="scss">
.book-wrapper {
  overflow: hidden;
  height: 100%;
  padding: 0 .48rem;
  line-height: 1.8;
  min-height: 100%;
  font-size: .6rem;

  .book {
    //position: relative;
    overflow: visible;
    height: 100%;
    -webkit-columns: calc(100vw - .96rem) 1;
    -webkit-column-gap: .96rem;
    columns: calc(100vw - .96rem) 1;
    column-gap: .96rem;
  }
}

.book {

}
</style>